# SYMFONY ALIASES
# ===============

CURRENT_USER=$(whoami)
NOT_SYMFONY_DIRECTORY_TEXT="This directory is not a root Symfony2 or higher project"

# Symfony1.4 commands
alias symfony='php symfony'
alias sf1_project='php lib/vendor/symfony/symfony1/data/bin/symfony generate:project' #My symfony 1.4's files are always placed on lib/vendor directory of the project
alias sf1_app='symfony generate:app'
alias sf1_module='symfony generate:module'
alias sf1_schema='symfony doctrine:build-schema'
alias sf1_model='symfony doctrine:build-model'
alias sf1_forms='symfony doctrine:build-forms'
alias sf1_classes='symfony doctrine:build --all-classes'
alias sf1_build_all='symfony doctrine:build --all --no-confirmation'
alias sf1_cc='symfony cc'
alias sf1_clear='sf1_cc'
alias sf1_create_cache='mkdir cache && chmod -R 777 cache'
alias sf1_create_log='mkdir log && chmod -R 777 log'


# Symfony2 or Symfony3 commands
sfcn () {
    if [ -e app/console ]; then
        php app/console $@
    elif [ -e bin/console ]; then
        php bin/console $@
    else
        echo $NOT_SYMFONY_DIRECTORY_TEXT
    fi
}
sfcc () {
    if [ -e app/console ]; then
        sudo rm -rf app/cache/* && sudo chmod -R 777 app/cache/ app/logs/
    elif [ -e bin/console ]; then
        sfcn cache:clear --env=dev
        # Under Symfony 3, the permissions are fixed
        # sudo rm -rf var/cache/* && sudo chmod -R 777 var/cache/ var/logs/
    else
        echo $NOT_SYMFONY_DIRECTORY_TEXT
    fi
}
sffix () {
    if [ -e app/console ]; then
        sudo chown -R $CURRENT_USER:$CURRENT_USER app/cache/ app/logs/
    elif [ -e bin/console ]; then
        # Under Symfony 3, the permissions are fixed
        # sudo chown -R $CURRENT_USER:$CURRENT_USER var/cache/ var/logs/
    else
        echo $NOT_SYMFONY_DIRECTORY_TEXT
    fi
}
alias sfclear='sfcc'
sfccfix () {
    local SF_VAR_DIR=''
    if [ -e app/console ]; then
        SF_VAR_DIR='app'
    elif [ -e bin/console ]; then
        SF_VAR_DIR='var'
    else
        echo $NOT_SYMFONY_DIRECTORY_TEXT
    fi

    if [[ "$SF_VAR_DIR" != "" ]]; then
        sfcc && sffix
        if [ -f "$SF_VAR_DIR/cache/.gitkeep" ]; then
            gco "$SF_VAR_DIR/cache/.gitkeep"
        fi
        if [ -f "$SF_VAR_DIR/logs/.gitkeep" ]; then
            gco "$SF_VAR_DIR/logs/.gitkeep"
        fi
    fi
}
alias sfproject='composer create-project symfony/framework-standard-edition' #Ex: sfproject my-project "2.7.*"
alias sfbundle='sfcn generate:bundle' #Ex: sfbundle --namespace=Acme/TestBundle
alias sfserver='sfcn server:run'
alias sfsecurity='sfcn security:check'

sfcreate () {
    local PROCEED_INSTALL=0
    local VERSION_INSTALL=''
    local TARGET_DIRECTORY='project-symfony'

    if [[ -n $2 ]]; then
        TARGET_DIRECTORY=$2
    fi

    if [[ "$1" == 'v2' ]]; then
        PROCEED_INSTALL=1
        VERSION_INSTALL="2.8.*"
    elif [[ "$1" == 'v3' ]]; then
        PROCEED_INSTALL=1
    else
        echo "The first parameter must be the version of Symfony project to create. Ex: v2 or v3"
        echo "The second parameter is the name of the project. It is optional!"
    fi

    if [[ $PROCEED_INSTALL -eq 1 ]]; then
        get_composer
        sfproject $TARGET_DIRECTORY $VERSION_INSTALL
        mv composer.phar $TARGET_DIRECTORY
        cd $TARGET_DIRECTORY
    fi
}
